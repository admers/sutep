<?//ini_set('memory_limit','512');class GestorArticulos{	#MOSTRAR IMAGEN ARTÍCULO	#------------------------------------------------------------	public function mostrarImagenController($datos){  /*      list($ancho,$alto)=getimagesize($datos);        if($ancho < 1920 || $alto < 1080){            echo 0;        }        else{            $aleatorio = mt_rand(100, 999);            $ruta = "../../views/images/noticia/temp/noticia".$aleatorio.".jpg";            $nuevo_ancho = 1280;            $nuevo_alto = 768;            $origen = imagecreatefromjpeg($datos);            #imagecreatetruecolor — Crear una nueva imagen de color verdadero            $destino = imagecreatetruecolor($nuevo_ancho, $nuevo_alto);            #imagecopyresized() - copia una porción de una imagen a otra imagen.            #bool imagecopyresized( $destino, $origen, int $destino_x, int $destino_y, int $origen_x, int $origen_y, int $destino_w, int $destino_h, int $origen_w, int $origen_h)            imagecopyresized($destino, $origen, 0, 0, 0, 0, $nuevo_ancho, $nuevo_alto, $ancho, $alto);            imagejpeg($destino, $ruta);            echo $ruta;        }*/		list($ancho, $alto) = getimagesize($datos);		if($ancho < 1920 || $alto < 1080){			echo 0;		}		else{			$aleatorio = mt_rand(100, 999);			$ruta = "../../views/images/articulos/temp/articulo".$aleatorio.".jpg";            $nuevo_ancho = 1280;            $nuevo_alto = 768;            $origen = imagecreatefromjpeg($datos);            $destino = imagecreatetruecolor($nuevo_ancho, $nuevo_alto);            imagecopyresized($destino, $origen, 0, 0, 0, 0, $nuevo_ancho, $nuevo_alto, $ancho, $alto);            imagejpeg($destino, $ruta);            echo $ruta;           /* $destino = imagecrop($origen, ["x"=>0, "y"=>0, "width"=>800, "height"=>400]);			imagejpeg($destino, $ruta);			echo $ruta;*/		}	}    #GUARDAR ARTÍCULO	#------------------------------------------------------------    public function guardarArticuloController(){            if(isset($_POST["tituloArticulo"])){			$imagen = $_FILES["imagen"]["tmp_name"];			$borrar = glob("views/images/articulos/temp/*");			foreach($borrar as $file){				unlink($file);			}        list($ancho,$alto)=getimagesize($imagen);      /*  if($ancho < 1920 || $alto < 1080){            echo 0;        }else{*/            $aleatorio = mt_rand(100, 999);        $nombre_tem = $_FILES['documt']['tmp_name'];        $rutaA = 'views/images/adjuntos/documento'.$aleatorio.".PDF";        move_uploaded_file($nombre_tem,$rutaA);            $ruta = "views/images/articulos/articulo".$aleatorio.".jpg";            $nuevo_ancho = 1920 ;            $nuevo_alto = 1080 ;            $destino = imagecreatetruecolor($nuevo_ancho, $nuevo_alto);            $origen = imagecreatefromjpeg($imagen);            imagecopyresized($destino, $origen, 0, 0, 0, 0, $nuevo_ancho, $nuevo_alto, $ancho, $alto);            imagejpeg($destino, $ruta);            #---------------------time--------------------            ini_set('date.timezone','America/Lima');            $time2 = date('d-m-Y');            #--------------------------------------------------            $datosController = array("titulo"=>$_POST["tituloArticulo"],                "introduccion"=>$_POST["introArticulo"]."...",                "ruta"=>$ruta,                "contenido"=>$_POST["contenidoArticulo"],                "fecha"=>$time2,                "rutaDO" => $rutaA);            $respuesta = GestorArticulosModel::guardarArticuloModel($datosController, "articulos");            if($respuesta == "ok"){                echo'<script>					swal({						  title: "¡OK!",						  text: "¡El artículo ha sido creado correctamente!",						  type: "success",						  confirmButtonText: "Cerrar",						  closeOnConfirm: false					},					function(isConfirm){							 if (isConfirm) {	   							    window.location = "articulos";							  } 					});				</script>';            }            else{                echo $respuesta;            }       // }    }	}	public function mostrarArticuloController(){		$respuesta = GestorArticulosModel::mostrarArticulosModel("articulos");				foreach($respuesta as $row => $item) {			echo ' <li id="'.$item["id"].'" class="bloqueArticulo">					<span class="handleArticle">					<a href="index.php?action=articulos&idBorrar='.$item["id"].'&rutaImagen='.$item["ruta"].'">						<i class="fa fa-times btn btn-danger"></i>					</a>					<i class="fa fa-pencil btn btn-primary editarArticulo"></i>						</span>					<img src="'.$item["ruta"].'" class="img-thumbnail">					<h1>'.$item["titulo"].'</h1>					<p>'.$item["introduccion"].'</p>                										<a href="#articulo'.$item["id"].'" data-toggle="modal">					<button class="btn btn-default">Leer Más</button>					</a>                    <p>'.$item["fecha"].'</p>					<hr>				</li>				<div id="articulo'.$item["id"].'" class="modal fade">					<div class="modal-dialog modal-content">						<div class="modal-header" style="border:1px solid #eee">							<button type="button" class="close" data-dismiss="modal">&times;</button>						 <h3 class="modal-title">'.$item["titulo"].'</h3>						</div>						<div class="modal-body" style="border:1px solid #eee">			      							<img src="'.$item["ruta"].'" width="100%" style="margin-bottom:20px">							<p class="parrafoContenido">'.$item["contenido"].'							     <a type="application/pdf"  target="_blank" href="http://localhost/sutep/backend/'.$item['rutaD'].'"><span class="glyphicon glyphicon-save"></span></a>						    </p>						</div>						<div class="modal-footer" style="border:1px solid #eee">							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>						</div>					</div>				</div>';		}	}	#ACTUALIZAR ORDEN	#---------------------------------------------------	public function actualizarOrdenController($datos){		GestorArticulosModel::actualizarOrdenModel($datos, "articulos");		$respuesta = GestorArticulosModel::seleccionarOrdenModel("articulos");		foreach($respuesta as $row => $item){			echo ' <li id="'.$item["id"].'" class="bloqueArticulo">					<span class="handleArticle">					<a href="index.php?action=articulos&idBorrar='.$item["id"].'&rutaImagen='.$item["ruta"].'">						<i class="fa fa-times btn btn-danger"></i>					</a>					<i class="fa fa-pencil btn btn-primary editarArticulo"></i>						</span>					<img src="'.$item["ruta"].'" class="img-thumbnail">					<h1>'.$item["titulo"].'</h1>					<p>'.$item["introduccion"].'</p>					<input type="hidden" value="'.$item["contenido"].'">					<a href="#articulo'.$item["id"].'" data-toggle="modal">					<button class="btn btn-default">Leer Más</button>					</a>                    <p>'.$item["fecha"].'</p>					<hr>				</li>				<div id="articulo'.$item["id"].'" class="modal fade">					<div class="modal-dialog modal-content">						<div class="modal-header" style="border:1px solid #eee">				        							<button type="button" class="close" data-dismiss="modal">&times;</button>						 <h3 class="modal-title">'.$item["titulo"].'</h3>			        						</div>						<div class="modal-body" style="border:1px solid #eee">			        							<img src="'.$item["ruta"].'" width="100%" style="margin-bottom:20px">							<p class="parrafoContenido">'.$item["contenido"].'</p>			        						</div>						<div class="modal-footer" style="border:1px solid #eee">			        							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>			        						</div>					</div>				</div>';		}	}	#BORRAR ARTICULO	#------------------------------------	public function borrarArticuloController(){		if(isset($_GET["idBorrar"])){			unlink($_GET["rutaImagen"]);			$datosController = $_GET["idBorrar"];			$respuesta = GestorArticulosModel::borrarArticuloModel($datosController, "articulos");			if($respuesta == "ok"){					echo'<script>					swal({						  title: "¡OK!",						  text: "¡El artículo se ha borrado correctamente!",						  type: "success",						  confirmButtonText: "Cerrar",						  closeOnConfirm: false					},					function(isConfirm){							 if (isConfirm) {	   							    window.location = "articulos";							  } 					});				</script>';			}		}	}#----------------------------------------VIDEOS---------------------------------------------------------------------#MOSTRAR VIDEO AJAX    #------------------------------------------------------------    public function mostrarVideoController(){	    if (isset($_POST['tituloVideo'])){            $aleatorio = mt_rand(100, 999);            $nombre_tem1 = $_FILES['video']['tmp_name'];           // $rutaA = 'views/images/adjuntos/documento'.$aleatorio.".PDF";            //move_uploaded_file($nombre_tem,$rutaA);            $ruta = "views/videos/video".$aleatorio.".mp4";            //$ruta = "../../views/videos/video".$aleatorio.".mp4";            move_uploaded_file($nombre_tem1 , $ruta);            $datosController = array(                "titulo"=>$_POST["tituloVideo"],                "ruta"=>$ruta               );            GestorArticulosModel::subirVideoModel($datosController, "videos");            $respuesta = GestorArticulosModel::mostrarVideoModel($ruta, "videos");            if($respuesta == "ok"){                echo'<script>                        swal({                              title: "¡OK!",                              text: "¡El video si subio correctamente!",                              type: "success",                              confirmButtonText: "Cerrar",                              closeOnConfirm: false                        },                        function(isConfirm){                                 if (isConfirm) {                                    window.location = "videos";                                  }                        });                    </script>';            }            else{                echo $respuesta;            }            $enviarDatos = $respuesta["ruta"];           echo $enviarDatos;	    }    }    #MOSTRAR VIDEOS EN LA VISTA    #------------------------------------------------------------    public function mostrarVideoVistaController(){        $respuesta = GestorArticulosModel::mostrarVideoVistaModel("videos");        foreach($respuesta as $row => $item){            echo '<li id="'.$item["id"].'" class="bloqueVideo">                    <label>'.$item["titulo"].'</label>					<span class="fa fa-times eliminarVideo" ruta="'.$item["ruta"].'"></span>					<video controls class="handleVideo">						<source src="'.$item["ruta"].'" type="video/mp4">					</video>					</li>';        }    }    #ELIMINAR VIDEO    #-----------------------------------------------------------    public function eliminarVideoController($datos){        $respuesta = GestorArticulosModel::eliminarVideoModel($datos, "videos");        unlink($datos["rutaVideo"]);        echo $respuesta;    }}